# yaml-language-server: $schema=https://schema.zeabur.app/template.json
apiVersion: zeabur.com/v1
kind: Template
metadata:
  name: nginx-internal-proxy
  description: Zeabur Nginx æ¨¡æ¿ï¼Œæ”¯æŒè‡ªå®šä¹‰åŸŸåå’Œå†…éƒ¨æœåŠ¡åä»£
  icon: https://www.svgrepo.com/show/373924/nginx.svg
spec:
  variables:
    - key: DOMAIN
      name: è‡ªå®šä¹‰åŸŸå
      description: ç»‘å®šçš„ Zeabur å…¬ç½‘åŸŸåï¼ˆè‡ªåŠ¨ç­¾å‘ HTTPSï¼‰
      type: DOMAIN

  services:
    - name: app
      icon: https://www.svgrepo.com/show/332595/api.svg
      template: PREBUILT
      spec:
        source:
          image: hashicorp/http-echo:latest
        ports:
          - id: app_port
            port: 5678
            type: HTTP
        configs:
          - path: /etc/http-echo/config.json
            template: |-
              {
                "text": "Hello from internal app service!"
              }

    - name: nginx
      icon: https://www.svgrepo.com/show/373924/nginx.svg
      template: PREBUILT
      spec:
        dependsOn:
          - app
        domainKey: DOMAIN
        source:
          image: nginx:alpine
        ports:
          - id: web
            port: 80
            type: HTTP
        configs:
          - path: /etc/nginx/conf.d/default.conf
            template: |-
              server {
                  listen 80;
                  server_name ${DOMAIN};

                  location / {
                      proxy_pass http://app.zeabur.internal:5678;
                      proxy_http_version 1.1;
                      proxy_set_header Host $host;
                      proxy_set_header X-Real-IP $remote_addr;
                      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                  }
              }

localization:
  zh-CN:
    description: Zeabur Nginx æ¨¡æ¿ï¼Œå¯ç»‘å®šè‡ªå®šä¹‰åŸŸåï¼Œå¹¶å°†å†…éƒ¨æœåŠ¡é€šè¿‡åä»£æš´éœ²åˆ°å¤–éƒ¨ã€‚
    readme: |
      # ğŸš€ Zeabur Nginx + å†…éƒ¨åä»£æ¨¡æ¿

      æœ¬æ¨¡æ¿å¯åœ¨ Zeabur å¹³å°éƒ¨ç½² Nginxï¼Œå¹¶å°†å†…éƒ¨æœåŠ¡é€šè¿‡åä»£æš´éœ²ã€‚  
      æ”¯æŒè‡ªå®šä¹‰åŸŸåå’Œè‡ªåŠ¨ HTTPSã€‚

      ## ğŸ”§ ä½¿ç”¨æ­¥éª¤
      1. å¡«å†™ **DOMAIN** ç»‘å®šåŸŸå  
      2. éƒ¨ç½²å®Œæˆåï¼Œè®¿é—®åŸŸåå³å¯é€šè¿‡ Nginx è®¿é—®å†…éƒ¨æœåŠ¡
