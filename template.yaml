# yaml-language-server: $schema=https://schema.zeabur.app/template.json
apiVersion: zeabur.com/v1
kind: Template
metadata:
  name: v2ray-nginx-zeabur
  description: ä¸€ä¸ªä¸º Zeabur ä¼˜åŒ–çš„ V2Ray + Nginx éƒ¨ç½²æ¨¡æ¿ï¼Œæ”¯æŒ WebSocket + TLS è‡ªåŠ¨åä»£ã€‚
  icon: https://raw.githubusercontent.com/2dust/v2rayN/refs/heads/master/v2rayN/v2rayN/Resources/v2rayN.ico
spec:
  variables:
    - key: DOMAIN
      name: è‡ªå®šä¹‰åŸŸå
      description: ç»‘å®šçš„ Zeabur å…¬ç½‘åŸŸåï¼ˆè‡ªåŠ¨ç­¾å‘ HTTPSï¼‰
      type: DOMAIN
    - key: V2RAY_UUID
      name: V2Ray ç”¨æˆ· UUID
      description: ä»£ç†ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦
      type: STRING
      default: auto

  services:
    - name: v2ray
      icon: https://raw.githubusercontent.com/2dust/v2rayN/refs/heads/master/v2rayN/v2rayN/Resources/v2rayN.ico
      template: PREBUILT_V2
      spec:
        source:
          image: teddysun/xray:latest
        ports:
          - id: v2ray_port
            port: 1080
            type: TCP
        configs:
          - path: /etc/xray/config.json
            template: |-
              {
                "inbounds": [
                  {
                    "port": 1080,
                    "protocol": "vless",
                    "settings": {
                      "clients": [
                        {
                          "id": "${V2RAY_UUID}"
                        }
                      ],
                      "decryption": "none"
                    },
                    "streamSettings": {
                      "network": "ws",
                      "wsSettings": {
                        "path": "/"
                      }
                    }
                  }
                ],
                "outbounds": [
                  {
                    "protocol": "freedom"
                  }
                ]
              }

    - name: nginx
      icon: https://www.svgrepo.com/show/373924/nginx.svg
      template: PREBUILT_V2
      domainKey: DOMAIN
      spec:
        source:
          image: nginx:alpine
        ports:
          - id: web
            port: 80
            type: HTTP
        configs:
          - path: /etc/nginx/conf.d/default.conf
            template: |-
              server {
                  listen 80;
                  server_name ${DOMAIN};

                  location / {
                      proxy_pass http://v2ray.zeabur.internal:1080;
                      proxy_http_version 1.1;
                      proxy_set_header Upgrade $http_upgrade;
                      proxy_set_header Connection "upgrade";
                      proxy_set_header Host $host;
                      proxy_set_header X-Real-IP $remote_addr;
                      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                  }
              }

localization:
  zh-CN:
    description: ä¸º Zeabur ä¼˜åŒ–çš„ V2Ray + Nginx æ¨¡æ¿ï¼Œè‡ªåŠ¨ç»‘å®šåŸŸåã€ç­¾å‘ HTTPS å¹¶æ”¯æŒ WebSocketã€‚
    readme: |
      # ğŸš€ Zeabur V2Ray + Nginx æ¨¡æ¿

      æœ¬æ¨¡æ¿å¯åœ¨ Zeabur å¹³å°ä¸Šä¸€é”®éƒ¨ç½² V2Ray + Nginx ç¯å¢ƒï¼Œ  
      æ”¯æŒ VLESS + WS + TLSï¼Œå…¨è‡ªåŠ¨åä»£é…ç½®ã€‚

      ## ğŸ”§ ä½¿ç”¨æ­¥éª¤
      1. åœ¨éƒ¨ç½²æ—¶å¡«å†™ï¼š
         - **DOMAIN**ï¼šç»‘å®šçš„ Zeabur å…¬ç½‘åŸŸåï¼ˆå¦‚ `kysn.zeabur.app` æˆ–è‡ªå®šä¹‰åŸŸåï¼‰
         - **V2RAY_UUID**ï¼šå®¢æˆ·ç«¯ UUIDï¼ˆå¯ç•™ç©ºè‡ªåŠ¨ç”Ÿæˆï¼‰
      2. éƒ¨ç½²å®Œæˆåï¼ŒZeabur è‡ªåŠ¨åˆ†é… HTTPS åŸŸåã€‚
      3. ä½¿ç”¨ v2rayNã€Shadowrocket ç­‰å®¢æˆ·ç«¯è¿æ¥ã€‚

      ## âš™ï¸ å®¢æˆ·ç«¯è¿æ¥é…ç½®
      ```
      vless://<V2RAY_UUID>@<DOMAIN>:443?encryption=none&security=tls&type=ws&path=/#Zeabur-V2Ray
      ```

      ## ğŸ“¦ æœåŠ¡è¯´æ˜
      - **v2ray**ï¼šå†…éƒ¨æä¾›ä»£ç†æœåŠ¡ï¼Œç›‘å¬ 1080 ç«¯å£ã€‚
      - **nginx**ï¼šå¯¹å¤–æä¾› HTTP(S) æœåŠ¡ï¼Œå¹¶åä»£è‡³ v2rayã€‚
